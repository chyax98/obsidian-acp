# Claude Agent SDK å•å…ƒæµ‹è¯•

æœ¬ç›®å½•åŒ…å« Claude Agent SDK çš„ç‹¬ç«‹æµ‹è¯•è„šæœ¬ï¼Œå¯åœ¨ Node.js ç¯å¢ƒä¸­ç›´æ¥è¿è¡Œï¼Œæ— éœ€ Obsidianã€‚

## æµ‹è¯•æ–‡ä»¶

### 1. `test-sdk-quick.js` - å¿«é€ŸéªŒè¯æµ‹è¯•

æœ€ç®€å•çš„æµ‹è¯•ï¼ŒéªŒè¯ SDK æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# è®¾ç½® API Key
export ANTHROPIC_API_KEY=sk-ant-api03-...

# è¿è¡Œæµ‹è¯•
node test-sdk-quick.js
```

**æµ‹è¯•å†…å®¹ï¼š**
- âœ“ åˆ›å»º query
- âœ“ æ¥æ”¶æµå¼å“åº”
- âœ“ è·å–æœ€ç»ˆç»“æœ
- âœ“ é”™è¯¯æ£€æµ‹

**é¢„æœŸè¾“å‡ºï¼š**
```
ğŸš€ Claude SDK å¿«é€Ÿæµ‹è¯•

â†’ åˆ›å»ºæŸ¥è¯¢...
âœ“ æŸ¥è¯¢å·²åˆ›å»º

â†’ ç­‰å¾…å“åº”...

ä½ å¥½ï¼æˆ‘æ˜¯ Claudeï¼Œä¸€ä¸ªç”± Anthropic å¼€å‘çš„ AI åŠ©æ‰‹ã€‚

âœ“ å®Œæˆ
  æ¶ˆæ¯æ•°: 12
  æ–‡æœ¬é•¿åº¦: 45 å­—ç¬¦
  è´¹ç”¨: $0.00123
  é”™è¯¯: å¦

âœ… æµ‹è¯•é€šè¿‡ï¼SDK å·¥ä½œæ­£å¸¸
```

---

### 2. `test-claude-sdk.js` - å®Œæ•´æµ‹è¯•å¥—ä»¶

åŒ…å« 4 ä¸ªå®Œæ•´æµ‹è¯•ç”¨ä¾‹çš„æµ‹è¯•å¥—ä»¶ã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# è®¾ç½® API Key
export ANTHROPIC_API_KEY=sk-ant-api03-...

# è¿è¡Œå®Œæ•´æµ‹è¯•
node test-claude-sdk.js
```

**æµ‹è¯•ç”¨ä¾‹ï¼š**

#### æµ‹è¯• 1: åŸºç¡€è¿æ¥å’Œå“åº”
- âœ“ åˆ›å»º query
- âœ“ æ¥æ”¶æµå¼äº‹ä»¶
- âœ“ è·å–æ–‡æœ¬å†…å®¹
- âœ“ è·å–æœ€ç»ˆç»“æœ
- âœ“ æ— é”™è¯¯

#### æµ‹è¯• 2: å·¥å…·è°ƒç”¨å’Œæƒé™
- âœ“ è§¦å‘å·¥å…·è°ƒç”¨ï¼ˆåˆ—å‡ºæ–‡ä»¶ï¼‰
- âœ“ æƒé™å›è°ƒè¢«è°ƒç”¨
- âœ“ è‡ªåŠ¨æ‰¹å‡† read ç±»å·¥å…·
- âœ“ æ‹’ç» write ç±»å·¥å…·

#### æµ‹è¯• 3: é”™è¯¯å¤„ç†
- âœ“ ä½¿ç”¨æ— æ•ˆ API Key
- âœ“ æ­£ç¡®æ•è·é”™è¯¯
- âœ“ é”™è¯¯æ¶ˆæ¯å®Œæ•´

#### æµ‹è¯• 4: å–æ¶ˆæŸ¥è¯¢
- âœ“ åˆ›å»ºé•¿æ—¶é—´æŸ¥è¯¢
- âœ“ 2 ç§’åè°ƒç”¨ interrupt()
- âœ“ æŸ¥è¯¢è¢«ä¸­æ–­

**é¢„æœŸè¾“å‡ºï¼š**
```
============================================================
Claude Agent SDK æµ‹è¯•å¥—ä»¶
============================================================

[0ms] âœ“ æµ‹è¯• 1: åŸºç¡€è¿æ¥å’Œå“åº”
[123ms] â†’ Query å·²åˆ›å»ºï¼Œå¼€å§‹æ¥æ”¶æ¶ˆæ¯...
[456ms] â†’ æ¶ˆæ¯ #1: stream_event
...
[2341ms] âœ“ æ”¶åˆ°æœ€ç»ˆç»“æœ { isError: false, cost: 0.00123 }
[2342ms] âœ“ âœ… æµ‹è¯• 1 é€šè¿‡

------------------------------------------------------------

[2350ms] âœ“ æµ‹è¯• 2: å·¥å…·è°ƒç”¨å’Œæƒé™
[2456ms] â†’ å¼€å§‹ç›‘å¬å·¥å…·è°ƒç”¨...
[2789ms] âœ“ æƒé™è¯·æ±‚: glob { toolUseID: 'toolu_abc', ... }
[2790ms] âœ“ âœ“ è‡ªåŠ¨æ‰¹å‡†å·¥å…·: glob
[3123ms] âœ“ å·¥å…·è°ƒç”¨: glob { id: 'toolu_abc' }
...
[4567ms] âœ“ âœ… æµ‹è¯• 2 é€šè¿‡

------------------------------------------------------------

[4580ms] âœ“ æµ‹è¯• 3: é”™è¯¯å¤„ç†ï¼ˆæ— æ•ˆ API Keyï¼‰
[5123ms] âœ“ âœ“ æˆåŠŸæ•è·åˆ°é”™è¯¯: Invalid API key
[5124ms] âœ“ âœ… æµ‹è¯• 3 é€šè¿‡ï¼ˆæ­£ç¡®å¤„ç†é”™è¯¯ï¼‰

------------------------------------------------------------

[5130ms] âœ“ æµ‹è¯• 4: å–æ¶ˆæŸ¥è¯¢
[5234ms] â†’ å¼€å§‹æŸ¥è¯¢ï¼Œ2 ç§’åå–æ¶ˆ...
[7234ms] â†’ æ‰§è¡Œå–æ¶ˆæ“ä½œ...
[7235ms] âœ“ âœ“ æŸ¥è¯¢è¢«å–æ¶ˆ
[7236ms] âœ“ âœ… æµ‹è¯• 4 é€šè¿‡

------------------------------------------------------------

============================================================
æµ‹è¯•æ€»ç»“:
  æ€»è€—æ—¶: 7236 ms
  é”™è¯¯æ•°: 0
  è­¦å‘Šæ•°: 0
  æ—¥å¿—æ¡ç›®: 42
============================================================

æµ‹è¯•ç»“æœè¯¦æƒ…:
  æµ‹è¯• 1 (åŸºç¡€è¿æ¥): âœ… é€šè¿‡
  æµ‹è¯• 2 (å·¥å…·è°ƒç”¨): âœ… é€šè¿‡
  æµ‹è¯• 3 (é”™è¯¯å¤„ç†): âœ… é€šè¿‡
  æµ‹è¯• 4 (å–æ¶ˆæŸ¥è¯¢): âœ… é€šè¿‡

æ€»è®¡: 4/4 é€šè¿‡
```

---

## ç¯å¢ƒè¦æ±‚

- **Node.js**: >= 16.0.0
- **Dependencies**: `@anthropic-ai/claude-agent-sdk` (å·²åœ¨ package.json ä¸­)
- **API Key**: éœ€è¦æœ‰æ•ˆçš„ Anthropic API Key

## è·å– API Key

1. è®¿é—® [Anthropic Console](https://console.anthropic.com/)
2. åˆ›å»º API Key
3. è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
   ```bash
   export ANTHROPIC_API_KEY=sk-ant-api03-...
   ```

## è·³è¿‡å®é™… API è°ƒç”¨

å¦‚æœä¸æƒ³æ¶ˆè€— API é…é¢ï¼Œæµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨è·³è¿‡éœ€è¦ API Key çš„æµ‹è¯•ï¼š

```bash
# ä¸è®¾ç½® API Key
unset ANTHROPIC_API_KEY

# è¿è¡Œæµ‹è¯•
node test-claude-sdk.js
```

è¾“å‡ºä¼šæ˜¾ç¤ºï¼š
```
âš  æœªè®¾ç½® ANTHROPIC_API_KEYï¼Œè·³è¿‡å®é™… API è°ƒç”¨æµ‹è¯•
âœ“ æç¤º: export ANTHROPIC_API_KEY=sk-ant-...
```

---

## è°ƒè¯•æ¨¡å¼

æµ‹è¯•è„šæœ¬åŒ…å«è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼š

- `âœ“` - æˆåŠŸ
- `âœ—` - å¤±è´¥
- `âš ` - è­¦å‘Š
- `â†’` - è°ƒè¯•ä¿¡æ¯

æ‰€æœ‰æ—¥å¿—éƒ½å¸¦æœ‰æ—¶é—´æˆ³ï¼ˆä»æµ‹è¯•å¼€å§‹çš„æ¯«ç§’æ•°ï¼‰ã€‚

---

## CI/CD é›†æˆ

æµ‹è¯•è„šæœ¬è¿”å›æ ‡å‡†é€€å‡ºç ï¼š
- `0` - æ‰€æœ‰æµ‹è¯•é€šè¿‡
- `1` - æœ‰æµ‹è¯•å¤±è´¥

å¯ä»¥é›†æˆåˆ° CI æµç¨‹ï¼š

```yaml
# .github/workflows/test.yml
name: Test Claude SDK
on: [push]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
      - run: npm install
      - run: node test-sdk-quick.js
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: "Cannot find module '@anthropic-ai/claude-agent-sdk'"

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
npm install
```

### é—®é¢˜ 2: "ANTHROPIC_API_KEY is not set"

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
export ANTHROPIC_API_KEY=sk-ant-api03-...
```

### é—®é¢˜ 3: "spawn ENOENT" æˆ– "Command failed"

**åŸå› **: SDK éœ€è¦å¯åŠ¨å­è¿›ç¨‹

**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿åœ¨æ”¯æŒçš„ç¯å¢ƒä¸­è¿è¡Œï¼ˆmacOS/Linux/WSLï¼‰

### é—®é¢˜ 4: æµ‹è¯•è¶…æ—¶

**åŸå› **: ç½‘ç»œé—®é¢˜æˆ– API å“åº”æ…¢

**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œé‡è¯•æµ‹è¯•

---

## ä¸ Obsidian æ’ä»¶çš„å…³ç³»

è¿™äº›æµ‹è¯•è„šæœ¬æ˜¯**ç‹¬ç«‹çš„**ï¼Œä¸ä¾èµ– Obsidianï¼š

- âœ… å¯ä»¥åœ¨ CI/CD ä¸­è¿è¡Œ
- âœ… å¯ä»¥å¿«é€ŸéªŒè¯ SDK åŠŸèƒ½
- âœ… ä¸éœ€è¦å¯åŠ¨ Obsidian
- âœ… æµ‹è¯•æ ¸å¿ƒ SDK é€»è¾‘

Obsidian æ’ä»¶ä½¿ç”¨ `src/claude/sdk-connection.ts` åŒ…è£…äº† SDKï¼Œä½†æ ¸å¿ƒåŠŸèƒ½ç›¸åŒã€‚
