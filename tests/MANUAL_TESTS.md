# ACP 插件手动测试清单

> **版本**: 0.1.0
> **日期**: 2025-12-18
> **测试人员**: ___________

---

## 测试前准备

### 环境要求

- [ ] Obsidian 已安装（最新版本）
- [ ] 已安装至少一个 ACP Agent CLI：
  - [ ] Claude Code (`npx @zed-industries/claude-code-acp`)
  - [ ] Codex (`codex --experimental-acp`)
  - [ ] Gemini (`gemini`)
  - [ ] Qwen Code (`npx @qwen-code/qwen-code --experimental-acp`)
  - [ ] Goose (`goose acp`)

### 插件安装

- [ ] 将 `main.js`, `manifest.json`, `styles.css` 复制到 Vault 的 `.obsidian/plugins/obsidian-acp/` 目录
- [ ] 重启 Obsidian
- [ ] 在设置中启用 "ACP Agent Client" 插件

---

## 1. 基础功能测试

### 1.1 插件加载

- [ ] 插件在插件列表中显示
- [ ] 插件名称为 "ACP Agent Client"
- [ ] 插件可以正常启用/禁用
- [ ] 启用后左侧功能区出现 ACP 图标

### 1.2 ChatView 打开

- [ ] 点击左侧 ACP 图标可以打开 ChatView
- [ ] ChatView 标题显示为 "ACP Chat"
- [ ] ChatView 包含以下元素：
  - [ ] Agent 选择下拉框
  - [ ] 连接/断开按钮
  - [ ] 消息显示区域
  - [ ] 输入框
  - [ ] 发送按钮

---

## 2. Agent 连接测试

### 2.1 Agent 检测

- [ ] 打开 Agent 选择下拉框
- [ ] 显示已安装的 Agent（如 Claude Code）
- [ ] 显示未安装的 Agent（灰色或禁用状态）

### 2.2 连接 Claude Code

- [ ] 选择 "Claude Code"
- [ ] 点击"连接"按钮
- [ ] 连接状态显示"连接中..."
- [ ] 连接成功后显示"已连接"
- [ ] 控制台无错误日志

**预期结果**: 连接成功，按钮变为"断开"

**失败情况**:
- 连接超时（检查 Claude Code 是否正确安装）
- 子进程启动失败（检查权限）

### 2.3 连接 Codex（如果已安装）

- [ ] 选择 "Codex"
- [ ] 点击"连接"按钮
- [ ] 连接成功

### 2.4 连接 Gemini（如果已安装）

- [ ] 选择 "Gemini"
- [ ] 点击"连接"按钮
- [ ] 连接成功

### 2.5 断开连接

- [ ] 点击"断开"按钮
- [ ] 连接状态变为"未连接"
- [ ] Agent 选择框重新启用

---

## 3. 会话管理测试

### 3.1 创建新会话

- [ ] 连接到任意 Agent
- [ ] 会话自动创建
- [ ] 控制台显示会话 ID

### 3.2 会话状态

- [ ] 会话创建后显示欢迎消息或准备就绪提示
- [ ] 输入框启用，可以输入文本

---

## 4. 消息发送与接收测试

### 4.1 发送简单消息

- [ ] 在输入框输入 "你好"
- [ ] 点击发送按钮
- [ ] 用户消息显示在消息区域（靠右，浅色背景）
- [ ] Agent 开始响应（显示"思考中..."或加载动画）
- [ ] Agent 回复显示在消息区域（靠左，深色背景）

**预期结果**: 消息正常发送和接收

### 4.2 发送复杂问题

测试消息内容：
```
请帮我创建一个简单的 Markdown 文件，内容是今天的日期和一句问候语。
```

- [ ] 消息发送成功
- [ ] Agent 请求文件写入权限（弹出权限弹窗）
- [ ] 处理权限请求（见 5.1）

### 4.3 流式输出

- [ ] Agent 回复是逐步显示的（流式输出）
- [ ] 不是等待整个响应完成后一次性显示
- [ ] 消息区域自动滚动到底部

### 4.4 Markdown 渲染

测试消息：
```
请生成一个包含以下元素的 Markdown 示例：
1. 标题
2. 列表
3. 代码块
4. 粗体和斜体
```

- [ ] Agent 回复中的 Markdown 正确渲染：
  - [ ] 标题显示为不同大小
  - [ ] 列表正确缩进
  - [ ] 代码块有语法高亮
  - [ ] 粗体和斜体正确显示

---

## 5. 权限请求测试

### 5.1 文件写入权限

触发方式：发送消息 "请在我的 Vault 中创建一个测试文件 test.md"

- [ ] 弹出权限请求弹窗
- [ ] 弹窗显示：
  - [ ] 工具名称（如 "write_text_file"）
  - [ ] 文件路径
  - [ ] 操作描述
- [ ] 弹窗包含 4 个按钮：
  - [ ] "允许一次"
  - [ ] "始终允许"
  - [ ] "拒绝一次"
  - [ ] "始终拒绝"

#### 5.1.1 允许一次

- [ ] 点击"允许一次"
- [ ] 弹窗关闭
- [ ] Agent 继续执行
- [ ] 文件成功创建
- [ ] 消息区域显示工具调用结果

#### 5.1.2 拒绝一次

- [ ] 点击"拒绝一次"
- [ ] 弹窗关闭
- [ ] Agent 显示权限被拒绝的消息

### 5.2 文件读取权限

触发方式：发送消息 "请读取我 Vault 中的一个 Markdown 文件"

- [ ] 弹出权限请求弹窗
- [ ] 显示文件路径
- [ ] 允许后文件内容正常读取

### 5.3 命令执行权限（如果支持）

触发方式：发送消息 "请执行 ls 命令"

- [ ] 弹出权限请求弹窗
- [ ] 显示命令内容
- [ ] 处理权限响应

---

## 6. 工具调用渲染测试

### 6.1 工具调用卡片

- [ ] 工具调用显示为独立卡片
- [ ] 卡片包含：
  - [ ] 工具名称
  - [ ] 状态指示（pending/in_progress/completed/failed）
  - [ ] 状态图标

### 6.2 状态变化

- [ ] pending: 灰色，等待图标
- [ ] in_progress: 蓝色，加载动画
- [ ] completed: 绿色，勾选图标
- [ ] failed: 红色，错误图标

### 6.3 工具调用结果

- [ ] 工具调用完成后显示结果
- [ ] 结果内容格式正确（如文件内容、命令输出）

### 6.4 Diff 渲染（如果支持）

- [ ] 文件修改显示 diff
- [ ] 新增行显示为绿色
- [ ] 删除行显示为红色

---

## 7. 设置界面测试

### 7.1 打开设置

- [ ] 打开 Obsidian 设置
- [ ] 找到 "ACP Agent Client" 插件设置页
- [ ] 设置页正常显示

### 7.2 默认 Agent 设置

- [ ] "默认 Agent" 下拉框显示
- [ ] 列出所有支持的 Agent
- [ ] 选择默认 Agent
- [ ] 保存设置
- [ ] 重新打开 ChatView，默认选中该 Agent

### 7.3 工作目录设置

- [ ] "默认工作目录" 选项显示
- [ ] 包含选项：
  - [ ] Vault 根目录
  - [ ] 当前文件夹
  - [ ] 自定义路径
- [ ] 选择"自定义路径"时显示路径输入框
- [ ] 保存设置

### 7.4 UI 偏好设置

- [ ] "显示工具调用详情" 开关
- [ ] "自动批准文件读取" 开关
- [ ] 切换开关，设置生效

### 7.5 Agent 路径覆盖

- [ ] 每个 Agent 显示一行配置
- [ ] 可以输入自定义 CLI 路径
- [ ] 保存自定义路径
- [ ] 使用自定义路径连接 Agent

### 7.6 重置设置

- [ ] 点击"重置为默认"按钮（如果有）
- [ ] 所有设置恢复默认值

---

## 8. 会话持久化测试

### 8.1 保存会话

- [ ] 发送几条消息
- [ ] 关闭 ChatView
- [ ] 重新打开 ChatView
- [ ] 消息历史正确恢复

### 8.2 多会话管理

- [ ] 创建多个会话（如果支持）
- [ ] 会话列表显示所有会话
- [ ] 切换会话，内容正确显示
- [ ] 删除会话，数据被清除

### 8.3 会话元数据

- [ ] 会话包含元数据：
  - [ ] 创建时间
  - [ ] Agent 类型
  - [ ] 工作目录
- [ ] 元数据正确显示

---

## 9. 错误处理测试

### 9.1 连接错误

- [ ] 连接到未安装的 Agent
- [ ] 显示错误消息（如 "Agent 未安装"）
- [ ] 不会导致插件崩溃

### 9.2 超时错误

- [ ] 发送消息后等待超时（设置短超时时间）
- [ ] 显示超时错误消息
- [ ] 可以重新发送消息

### 9.3 Agent 崩溃

- [ ] 手动杀死 Agent 进程（在终端中）
- [ ] 插件检测到连接断开
- [ ] 显示连接断开消息
- [ ] 可以重新连接

### 9.4 无效响应

- [ ] Agent 返回格式错误的 JSON（模拟场景）
- [ ] 插件捕获错误
- [ ] 显示友好的错误消息

---

## 10. 性能测试

### 10.1 大量消息

- [ ] 发送 50 条消息
- [ ] 消息区域滚动流畅
- [ ] 内存占用合理（查看任务管理器）

### 10.2 长消息

- [ ] Agent 回复超长文本（如 5000 字）
- [ ] 渲染流畅，无卡顿
- [ ] Markdown 渲染正确

### 10.3 快速切换

- [ ] 快速打开/关闭 ChatView 多次
- [ ] 无内存泄漏
- [ ] 无错误日志

---

## 11. 会话取消测试

### 11.1 取消发送中的消息

- [ ] 发送一个需要较长时间处理的消息
- [ ] 在 Agent 响应期间点击"取消"按钮
- [ ] Agent 停止响应
- [ ] 显示取消消息

### 11.2 取消工具调用

- [ ] 触发工具调用
- [ ] 在工具执行期间点击"取消"
- [ ] 工具调用被取消

---

## 12. 跨平台测试（如果可行）

### 12.1 macOS

- [ ] 所有功能正常工作
- [ ] CLI 检测正确

### 12.2 Windows

- [ ] 所有功能正常工作
- [ ] CLI 检测使用 `where` 命令

### 12.3 Linux

- [ ] 所有功能正常工作
- [ ] CLI 检测使用 `which` 命令

---

## 测试总结

### 通过的测试

- 总计: _____ / _____
- 通过率: _____%

### 发现的问题

1.
2.
3.

### 建议改进

1.
2.
3.

### 测试结论

- [ ] 所有核心功能正常工作
- [ ] 可以发布为 Beta 版本
- [ ] 需要修复重大问题后再测试

---

## 附录：测试数据

### 测试用消息

1. 简单问候：`你好，请介绍一下你自己。`
2. 文件操作：`请创建一个名为 test-<timestamp>.md 的文件，内容为今天的日期。`
3. 代码生成：`请生成一个简单的 JavaScript 函数，计算两个数的和。`
4. Markdown 测试：`请生成一个包含各种 Markdown 元素的示例文档。`
5. 长回复测试：`请详细解释 Obsidian 插件开发的最佳实践。`

### 预期行为

- 所有消息应该正常发送和接收
- 权限请求正确弹出
- 工具调用正确执行
- UI 流畅无卡顿
